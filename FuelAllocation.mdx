---
title: "Fuel consumption estimation"
date: "2024-01-28"
tags: ["Python", "GHG", "Data Science"]
banner: "https://raw.githubusercontent.com/Ming2046/EnviroByte-Blog/master/images/fuelallocation.jpg"
description: "Calculation of fuel allocation using Python function"
blogType: "normal"
---

## Fuel consumption estimation

### AQM v2.3 Fuel Consumption Calculation (Equation C.6-1)

[Alberta greenhouse gas quantification methodologies, AQM v2.3](https://open.alberta.ca/publications/alberta-greenhouse-gas-quantification-methodologies) provides methods to estimate fuel consumption for combustion equipment. However, a critical issue arises in Equation C.6-1, where the calculation does not accurately reflect energy input as intended.

The equation provided in AQM v2.3 for estimating fuel consumption is:

$$
v_{fuel,j,p} = \sum_{j=1}^{N} \frac{P_{rate,j}}{n_{j}} \times\frac{LF_{i}}{LHV_{j}} \times OH_{i} \times 0.0036
$$

where

- $v_{fuel,j,p}$ is estimated fuel consumption from combustion equipment for a specific fuel type for the reporting period, p (m3).
- $j$ is equipment type
- $P_{rate,j}$ is the maximum rated **input** power of the equipment j (kW).
- $LF_{j}$ is the load factor for each type of equipment j.
- $OH_{j}$ is the operating hours for each type of equipment j.
- $n_{j}$ is the thermal efficiency of the equipment j.
- $LHV_{j}$ is the lower heating value of the fuel for each type of equipment j (GJ/m3).
- 0.0036 Conversion factor for kWh to GJ.

The thermal efficiency $n_{j}$ represents the ratio of output energy to input energy:

$$
n_{j} = \frac{output}{input}
$$

When this efficiency factor is applied in AQM's equation, the calculation inadvertently represents energy output rather than input.

## API Fuel Calculation

American Petroleum Institute (API)'s [Compendium of Greenhouse Gas Emissions Methodologies for the Natural Gas and Oil Industry, 2021](https://www.api.org/~/media/files/policy/esg/ghg/2021-api-ghg-compendium-110921.pdf) provides a correct methodology for calculating fuel consumption in Equation 4-5 and 4-6:

> API 2021 Equation 4-5.
>
> $$
> FC = ER \times LF \times OH \times ETT \times \frac{1}{HV}
> $$
>
> where,
>
> - FC is the fuel consumption (volume/year)
> - ER is the equipment rate (hp, kW, or J)
> - LF is the load factor
> - OH is the operating hours
> - ETT is the equipment thermal efficiency (Btu <sub>input</sub> / hp-hr <sub>output</sub>, Btu<sub>input</sub> / kW-hr <sub>output</sub>, or J<sub>input</sub> / J <sub>output</sub>)
> - HV is the higher heating value

In the API 2021 compendium, thermal efficiency is represented as input-to-output (opposite to the standard output-to-input convention), and equipment rate is based on the equipment's output power, unlike AQM v2.3's focus on input power.

## Nameplate

The inconsistency between AQM v2.3 and API v2021 methodologies can be attributed to differences in nameplate power definitions:

- For boilers and heaters, the nameplate often indicates energy input [1](https://www2.gov.bc.ca/gov/content/environment/waste-management/industrial-waste/agriculture/regulation-requirements/agricultural-boilers-heaters).
- In API v2021, the equipment rate corresponds to output energy.

## Correction to AQM v2.3 when Equipment Rate is based on Input Power

The AQM Table C-1 and C-2 provide both thermal efficiency and load factors (based on fractions of maximum rated power output). This correction implies that $P_{rated,j}$ should represent output power, not input as stated in AQM v2.3.

- For engines and motors: Nameplate power indicates output power, so AQM v2.3's approach can convert output to input.

- For heaters and boilers: Nameplate power already represents input power, so dividing by thermal efficiency is unnecessary. However, AQM v2.3 Table C-2 set the thermal efficiency for heaters and boilers as 1. The corrected equation for these types of equipment is:


$$
v_{fuel,j,p} = \sum_{j=1}^{N} P_{InputPowerRating,j} \times\frac{LF_{i}}{LHV_{j}} \times OH_{i} \times 0.0036
$$

where

- $v_{fuel,j,p}$ is estimated fuel consumption from combustion equipment for a specific fuel type for the reporting period, p (m3).
- $j$ is equipment type or individual equipment $j$
- $P_{rate,j}$ is the maximum rated **input** power of the equipment j (kW).
- $LF_{j}$ is the load factor for each type of equipment j.
- $OH_{j}$ is the operating hours for each type of equipment j.
- $LHV_{j}$ is the lower heating value of the fuel for each type of equipment j (GJ/m3).
- 0.0036 Conversion factor for kWh to GJ.

This correction aligns AQM with actual practice for fuel allocation calculations.


## Fuel consumption estimation when Equipment Rate is based on Output Power

Some equipment's nameplate power is based on output power, such as engines and motors. In this case, the fuel consumption estimation is based on the output power.

$$
v_{fuel,j,p} = \sum_{j=1}^{N} \frac{P_{OutputPowerRate,j}}{n_{j}} \times\frac{LF_{i}}{LHV_{j}} \times OH_{i} \times 0.0036
$$

where

- $v_{fuel,j,p}$ is estimated fuel consumption from combustion equipment for a specific fuel type for the reporting period, p (m3).
- $j$ is equipment type or individual equipment $j$
- $P_{rate,j}$ is the maximum rated **output** power of the equipment j (kW).
- $LF_{j}$ is the load factor for each type of equipment j.
- $OH_{j}$ is the operating hours for each type of equipment j.
- $n_{j}$ is the thermal efficiency of the equipment j.
- $LHV_{j}$ is the lower heating value of the fuel for each type of equipment j (GJ/m3 or GJ/e3m3).
- 0.0036 Conversion factor for kWh to GJ (GJ/kWh).

The thermal efficiency $n_{j}$ represents the ratio of output energy to input energy:

$$
n_{j} = \frac{output}{input}
$$

## Fuel Proration based on nameplate power

For GHG reporting, reporters often have one measured fuel consumption value for a block of equipment. In this case, fuel proration based on the nameplate power is used. This means that the total measured fuel consumption is allocated to individual equipment based on their theoretical fuel consumption estimation. The proration factor is the ratio of an individual equipment's estimated fuel consumption to the total estimated fuel consumption of the block.

$$
   ProrationFactor_j = \frac{v_{estimated,j,p}}{\sum_{j=1}^{N} v_{estimated,j,p}}
$$

where

- $ProrationFactor_j$ is the proration factor for equipment $j$.
- $v_{estimated,j,p}$ is the estimated theoretical fuel consumption for equipment $j$ for the reporting period $p$ (m3).
- $j$ represents the specific equipment type or ID.
- $N$ is the total number of equipment in the block.

Then, the individual equipment's allocated fuel consumption is calculated by multiplying the proration factor by the total measured fuel consumption for the block:

$$
v_{allocated,j,p} = ProrationFactor_j \times v_{MeasuredTotal,p}
$$

where

- $v_{allocated,j,p}$ is the allocated fuel consumption for equipment $j$ (m3).
- $v_{MeasuredTotal,p}$ is the total measured fuel consumption for the block of equipment (m3 or e3m3).

Combining the above equations, the fuel proration formula becomes:

$$
v_{allocated,j,p} = \frac{v_{estimated,j,p}}{\sum_{j=1}^{N} v_{estimated,j,p}} \times v_{MeasuredTotal,p}
$$

where

The term $\frac{v_{MeasuredTotal,p}}{\sum_{j=1}^{N} v_{estimated,j,p}}$ is often called the measured-to-estimated fuel ratio, $R_{M/E}$.

To prorate the total measured fuel to individual equipment using this ratio:

$$
v_{allocated,j,p} = v_{estimated,j,p} \times R_{M/E}
$$

where

- $v_{allocated,j,p}$ is the allocated fuel consumption for equipment $j$ (m3 or e3m3).
- $v_{estimated,j,p}$ is the estimated theoretical fuel consumption for equipment $j$.
- $R_{M/E}$ is the ratio of total measured fuel to total estimated fuel.

## Calculating GHG Emissions from Prorated Fuel

When using prorated fuel to calculate GHG emissions, it is important to align the fuel's energy basis with the GHG emission factor. Specifically, if the emission factors are based on Higher Heating Value (HHV), the prorated fuel volume should be converted using HHV. Conversely, if emission factors are based on Lower Heating Value (LHV), the prorated fuel should be based on LHV.

In Alberta, BC, and ECCC quantification methodology documents, emission factors are typically provided in HHV, so the fuel consumption used for emissions calculations should also be on an HHV basis.



## Python Code

To illustrate this methodology, weâ€™ve included a Python function to calculate allocated fuel consumption based on nameplate power, operating hours, load factor, and thermal efficiency.

```python
import pandas as pd

def calculate_allocated_fuel(row, df_clean):
    # Subset of the relevant block
    block = df_clean[(df_clean["Month"] == row["Month"]) & (df_clean["Phase"] == row["Phase"])]

    numerator = (row["Nameplate Power (kW)"] * row["Equipment Hours"] * row["Load"]) / row["Thermal Eff."]

    denominator = (
        (block["Nameplate Power (kW)"] * block["Equipment Hours"] * block["Load"]) / block["Thermal Eff."]
    ).sum()

    if denominator == 0:
        return 0
    else:
        return row["Fuel"] * (numerator / denominator)

df_clean["Allocated Fuel"] = df_clean.apply(lambda row: calculate_allocated_fuel(row, df_clean), axis=1)

print("Updated DataFrame with Allocated Fuel:")
print(df_clean.head(18))
print(df_clean.tail(18))

file_path = 'path_to_your_file.xlsx'
with pd.ExcelWriter(file_path, mode='a') as writer:
    df_clean.to_excel(writer, index=False, sheet_name='Allocated Fuel Data')

print("Updated DataFrame with Allocated Fuel has been written to a new sheet in the original Excel file.")
```

[1]: https://www2.gov.bc.ca/gov/content/environment/waste-management/industrial-waste/agriculture/regulation-requirements/agricultural-boilers-heaters
